/* 
 * MIRROR MODE - PREMIUM GLASSMORPHISM ENGINE v2.1
 * Optimized for Windows Chromium rendering reliability.
 */

/* 1. Root Variable Overrides - Target HTML specifically for highest inheritance */
html[data-mirror-mode='true'] {
  --bg-sidebar: color-mix(in srgb, rgb(var(--bg-sidebar-rgb)), transparent 72%);
  --bg-app: color-mix(in srgb, rgb(var(--bg-app-rgb)), transparent 45%);
  --bg-panel: color-mix(in srgb, rgb(var(--bg-sidebar-rgb)), transparent 88%);
  --border-dim: rgba(255, 255, 255, 0.08);
  --glass-blur: blur(25px) saturate(180%) brightness(105%);
}

/* 2. Hardware Accelerated Stacking Context */
[data-mirror-mode='true'] .app-shell {
  background: 
    radial-gradient(at 0% 0%, rgba(var(--text-accent-rgb), 0.25) 0px, transparent 50%),
    radial-gradient(at 80% 20%, rgba(138, 43, 226, 0.2) 0px, transparent 40%),
    radial-gradient(at 100% 100%, rgba(var(--text-accent-rgb), 0.15) 0px, transparent 50%),
    radial-gradient(at 20% 80%, rgba(138, 43, 226, 0.15) 0px, transparent 40%),
    rgb(var(--bg-app-rgb)) !important;
  background-size: 100% 100%;
  position: relative;
  overflow: hidden;
  transform: translateZ(0); /* Force GPU acceleration */
}

/* 3. Glass Panels with Forced GPU Rendering */
[data-mirror-mode='true'] .shell-sidebar-left,
[data-mirror-mode='true'] .shell-sidebar-right,
[data-mirror-mode='true'] .shell-ribbon,
[data-mirror-mode='true'] .shell-header,
[data-mirror-mode='true'] .workspace-tabbar,
[data-mirror-mode='true'] .pane-header,
[data-mirror-mode='true'] .chat-header,
[data-mirror-mode='true'] .sidebar-pane,
[data-mirror-mode='true'] .inspector-panel,
[data-mirror-mode='true'] .tab-bar-container {
  backdrop-filter: var(--glass-blur) !important;
  -webkit-backdrop-filter: var(--glass-blur) !important;
  background: var(--bg-sidebar) !important;
  border-color: var(--border-dim) !important;
  position: relative;
  z-index: 5;
  transform: translateZ(0); /* Kick-start Chromium's filter engine */
  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.08), 0 4px 15px rgba(0, 0, 0, 0.1);
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, transparent 40%), var(--bg-sidebar) !important;
}

/* 4. Glass Texture Grain */
[data-mirror-mode='true'] .shell-sidebar-left::after,
[data-mirror-mode='true'] .shell-sidebar-right::after,
[data-mirror-mode='true'] .shell-ribbon::after,
[data-mirror-mode='true'] .shell-header::after {
  content: '';
  position: absolute;
  inset: 0;
  z-index: -1;
  opacity: 0.04;
  pointer-events: none;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3e%3cfilter id='noiseFilter'%3e%3cturbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3e%3c/filter%3e%3crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3e%3c/svg%3e");
}

/* 5. Clean Workspace Layering */
[data-mirror-mode='true'] .shell-main {
  background: transparent !important;
  transform: translateZ(0);
}

[data-mirror-mode='true'] .lumina-dashboard,
[data-mirror-mode='true'] .shell-main-placeholder {
  background: transparent !important;
}

/* 6. Interaction Refinement */
[data-mirror-mode='true'] .workspace-tab.active {
  background: rgba(255, 255, 255, 0.15) !important;
  border-bottom: none !important;
}

[data-mirror-mode='true'] .tree-item:hover {
  background: rgba(255, 255, 255, 0.08) !important;
}

[data-mirror-mode='true'] .cm-editor {
  background: transparent !important;
}

/* 7. Background Light Movement */
[data-mirror-mode='true'] .app-shell::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle, rgba(var(--text-accent-rgb), 0.1) 0%, transparent 70%);
  animation: mirrorFloat 20s infinite alternate ease-in-out;
  pointer-events: none;
  z-index: 0;
}

@keyframes mirrorFloat {
  0% { transform: translate(0, 0) rotate(0deg); }
  100% { transform: translate(10%, 10%) rotate(10deg); }
}
